<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2015-07-20">

<title>On Theory – The OO-Ray</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-3b7f4aff7acac744aa1d596ce5db2ede.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KSSKDNK101"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-KSSKDNK101', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../texture-bw.png);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The OO-Ray</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../music.html"> 
<span class="menu-text">Music</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../videos.html"> 
<span class="menu-text">Videos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../press.html"> 
<span class="menu-text">Press Info</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../shows.html"> 
<span class="menu-text">Showography</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../licensing.html"> 
<span class="menu-text">Licensing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tinyletter.com/ooray"> 
<span class="menu-text">Mailing List</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ooray"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">On Theory</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 20, 2015</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><em>The following essay is part of a series I am writing on survival skills for artists. <a href="../tags/survival-skills-for-artists/">Here is the whole series.</a></em></p>
<p>Many artists have a bad relationship to theory. This is understandable. There are a lot of bad teachers of theory, who fail to add that theory is mostly a suggestion, and that figuring how to break these rules of music theory is part of the fun of learning it. Also, most of us were taught theory when we were adolescents, which made theory seem restrictive and something to rebel against.</p>
<p>Theory is really only the history of art distilled into the form of rules. Someone, at some point, attempted to separate the good art from the bad and building a set of rules seemed like the best way to do this. It is true that music is all about proportions, intervals, and math. But the reason why one piece affects us cannot be easily be quantified. As much as some art theorists believe, there are no single unfiying ideas about what separates ‘good’ art from the rest. The entirety of music and art, much like language, resists easy classification. Theory only has the authority we assign to it.</p>
<p>There is a prideful sneer to certain musicians when they confess they are completely self taught, and they don’t need music theory. They only need three chords, they say. Well, sad to say, but these people are still using theory, but in a very limited form.</p>
<p>On the other side are self indulgent theory junkies who put multiple key and signature changes in a song without bothering to ask whether there is actually intention and reason behind these choices. Their music often comes off as self indulgent. Their pieces are often crammed so full of ideas that none of them have room to develop or breathe.</p>
<p>There is a balance between these two approaches. I think that part of achieving that balance is realizing that theory can help us when we’re stuck for direction.</p>
<p>Theory can take many shapes and is not just limited to what we learned about harmony in university. Here are six examples that may expand your concept of theory and its place in music:</p>
<ol type="1">
<li>There are cross-pollinating theories, such as those suggested by Henry Cowell’s <em>New Musical Resources</em>.</li>
<li>Theory can include chord leading, which is a way to transform one chord into another.</li>
<li>Theory can include the study of tradition, such as the works of Bartok.</li>
<li>Theory includes general compositional strategies such as Brian Eno’s Oblique Strategies.</li>
<li>Theory includes ways to incorporate randomness such as those of John Cage, or non-traditional collaborators such as Messaien and birdsong.</li>
<li>Theory also includes improvisational game pieces such as those of John Zorn.</li>
</ol>
<p>I will talk a little about each of these types of theory.</p>
<p>Henry Cowell’s <em>New Musical Resources</em> is a fascinating little book and I highly recommend it as an example of theory expanding your boundaries. I think it is a wonderful example of applying concepts from one part of music to another. In it, he proposed to apply the principles of the overtone series to rhythm. He suggests new cross-rhythms that could be played based on the harmonic series (a simple cross rhythm is to play in 2 while someone else plays in 3, Cowell suggests crazy cross rhythms such as 5:8 and 4:7). His theory of tone clusters uses major second intervals instead of major thirds as the basis of chords, producing a new type of tonality. In many ways, Cowell’s approach is inspirational, especially in how it takes principles that govern one aspect of music and map it to another, producing new and unheard territory in the process.</p>
<p>You might have encountered chord leading as suggestions for selecting a set of chord changes as the structure of a piece. Chord leading suggests a number of chords that might follow another chord you have selected in your sequence. Chord leading is in effect a set of rules for transforming one chord into another in a musical sequence. We may need to only change one note in a chord to result into a completely different musical effect. Chord leading is pretty much a suggestion for building musical structures that are readily accepted by others. Shostakovich flaunted these rules. I think of his trio where in the context of his slow movement, the arrival of a major chord is a jarring event. But he could have only achieved such an effect by understanding chord leading and how to subvert our expectations as listeners.</p>
<p>Theory can ground us in a musical tradition by showing how our work relates to the past. I can’t imagine what Bela Bartok’s music would sound like without his intense study of Hungarian folk music and tradition. To participate in a tradition can add a powerful sense of familiarity to the work, especially if our piece uses some traditions and subverts others. (A very funny example of this is Erik Satie’s <em>Sonatine Bureaucratique</em>.) But we must provide enough of our own vision or risk the work being weighed down by tradition.</p>
<p>Theory can include compositional strategies, such as Brian Eno’s <em>Oblique Strategies</em>, a deck of cards with instructions which provide us with ways to recontexualize musical ideas. One of the most famous is “Honor thy mistake as a hidden intention.” These strategies can provide us with unexpected directions to take a musical piece, but their implementation must be organic and true to the nature of the piece. Otherwise, they are about useful as notes from studio executives.</p>
<p>A theory of chance and probability can be freeing. Both John Cage and Olivier Messaien incorporate such theories of randomness and chance into their work. This frees themselves of part of the compositional burden. John Cage’s pieces all have random elements but, not all of the musical elements in his pieces rely on this randomness. For example, in <em>Apartment house 1778</em>, Cage used chance to decide which parts to subtract from American Hymns. Randomness was used as a partner in composition, not as the overall determinant of the final work. Similarly, Messaien used birdsong to inject new ideas into his work, and his modes of limited transposition are a form of compositional restriction derived from analysis of his own work. However, even in the use of such systems, Cage and Messaien never abandon their own compositional tastes.</p>
<p>Theory can be embodied in those pieces that are improvisational games, such as John Zorn’s “game pieces”. “Cobra” is one such musical game, consisting of rules for improvisation that are switched on the fly by what Zorn calls a “prompter”, who functions much like a musical traffic cop, directing the musical flow from one improviser to the next. The theory in these games is a theory of musical interaction meant to increase the intersestingness of the piece to the listener. The games themselves are types of power struggles and with the right musicians, these power struggles can be compelling dramas.</p>
<p>Theory used in the context of connecting us to tradition and helping us overcome our ruts can be liberating. It’s only when we think of theory as rigid rules in a system that we find it restrictive. Yes, there was originally a rule of “no parallel fifths” in baroque composition. But power chords came out of flaunting this rule. Total serialism was often used as a rigid system and as a result, many serialist pieces lost the human element by giving up too much compositional control. Such rigid compositional systems can be intellectually intoxicating, but are really dead ends.</p>
<p>No theoretical system can completely relieve the composer of the most essential quality needed in composition: intent. Your decisions must be purposeful, compelling, and organic to the nature of your piece for your music to be compelling to others. You must discover the integrity of the piece and fight for that. Otherwise, you might as well as leave your music to the machines.</p>
<p>I hope that this essay encourages you to think of theory in a new light. We’ve surveyed the field of music theory and realized that it encompasses many techniques and ways of thinking that can help us when we are stuck in a compositional rut. So, start exploring the wide world of theory. You might be surprised.</p>
<p><strong>Resources and References</strong></p>
<p>There are a ton of music theory books that push the envelope. Here are a few that I used to write this essay.</p>
<p><a href="http://www.therestisnoise.com">The Rest is Noise</a>. If you want an introduction to composition in the 20th and 21st century, I can’t think of a better book. Pithily written, it’s a dishy account of a fascinating subject and a nice reference.</p>
<p><a href="http://zztt.org/lmc2_files/Cowell_New_Musical_Resources.pdf">New Musical Resources</a>. Henry Cowell’s slim volume provides us with an approach for recontextualizing music and its many aspects.</p>
<p><a href="http://www.musicarrangerspage.com/4606/chords-under-a-melody-chord-leading/">Chord leading</a>. Here’s a relatively easy to understand page that explains the concepts behind chord leading.</p>
<p><a href="http://www.rtqe.net/ObliqueStrategies/">Oblique Strategies</a>. Brian Eno’s deck of cards with compositional strategies have now taken many forms, including an app. These compositional heurisitics may be helpful. Now in its 5th edition.</p>
<p><a href="https://www2.ak.tu-berlin.de/~gastprof/collins/experimental-music/Zorn/americanmusic.28.1.0044.pdf">Some Notes on John Zorn’s Cobra</a>. Great essay analyzing the game piece “Cobra”.</p>
<p><a href="http://rosewhitemusic.com/piano/writings/introduction-music-john-cage/">The Music of John Cage</a> A book on the music of John Cage. I used some notes from the introduction in writing this essay. I also recommend his first book called “<a href="https://en.wikipedia.org/wiki/Silence:_Lectures_and_Writings">Silence: Lectures and Writings</a>” if you want to learn more about his ideas. Also check out his <a href="http://www.ubu.com/sound/cage.html">UbuWeb Page</a>.</p>
<p><a href="http://monoskop.org/images/5/50/Messiaen_Olivier_The_Technique_of_My_Musical_Language.pdf">The Technique of my Musical Language</a> Olivier Messaien’s master work on the techniques he used to compose. It’s not an easy read, but it’s very interesting all the same.</p>
<p><a href="http://www.ubu.com/papers/">UbuWeb’s Papers</a> house many classics of contemporary music theory, from Luigi Russolo’s “<a href="http://www.ubu.com/papers/russolo.html">The Art of Noises</a>” and Pierre Boulez’s “<a href="http://www.ubu.com/papers/Boulez-Schoenberg+Is+Dead.pdf">Schoenberg is Dead</a>”.</p>
<p><em>This essay is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>. Please share freely, as long as you attribute me as its creator (Ted Laderas, ted@15people.net).</em></p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>